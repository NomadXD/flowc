name: "petstore-api"
version: "1.0.0"
description: "Pet Store API example"
context: "petstore"

# Gateway hierarchy targeting
# The gateway hierarchy is: Gateway → Listener → Environment
# Replace these values with actual ones from your setup:
#   1. Get gateway ID: curl http://localhost:8080/api/v1/gateways
#   2. Get listener port: curl http://localhost:8080/api/v1/gateways/{gateway_id}/listeners
#   3. Get environment name: curl http://localhost:8080/api/v1/gateways/{gateway_id}/listeners/{port}/environments
gateway:
  # Option 1: Use gateway_id (recommended)
  # Replace with actual gateway ID from your FlowC instance
  gateway_id: "REPLACE_WITH_GATEWAY_ID"

  # Option 2: Use node_id (backward compatible, will be resolved to gateway_id)
  # node_id: "test-envoy-node"

  # Required: Port of the listener within the gateway
  # This must match an existing listener port on the gateway
  port: 9095

  # Required: Environment name within the listener
  # This must match an existing environment name on the listener
  # Environments are isolated using hostname-based SNI matching
  environment: "production"

  # Virtual host configuration for route matching
  # Domains should match the environment's hostname or be more specific
  virtual_host:
    domains: ["api.example.com"]

upstream:
  host: "petstore.swagger.io"
  port: 443
  scheme: "https"
  timeout: "30s"

# XDS Strategy configuration for this deployment
# These strategies define how THIS API should be deployed and managed
strategy:
  deployment:
    type: "basic"  # Options: basic, canary, blue-green, external
  
  route_matching:
    type: "prefix"
    case_sensitive: true
  
  load_balancing:
    type: "round-robin"
    choice_count: 2
    health_check:
      enabled: true
      interval: "10s"
      timeout: "5s"
      healthy_count: 2
      unhealthy_count: 3
      path: "/health"
      expected_status: 200
  
  retry:
    type: "conservative"
    max_retries: 2
    retry_on: "5xx,reset,connect-failure"
    per_try_timeout: "5s"
  
  rate_limiting:
    type: "global"
    requests_per_minute: 1000
    burst_size: 100
  
  observability:
    tracing:
      enabled: true
      provider: "zipkin"
      sampling_rate: 0.1
      endpoint: "http://zipkin:9411/api/v2/spans"
    metrics:
      enabled: true
      provider: "prometheus"
      path: "/metrics"
      port: 9090
    access_logs:
      enabled: true
      format: "json"
      path: "stdout"

labels:
  environment: "production"
  team: "api-team"
  service: "petstore"
