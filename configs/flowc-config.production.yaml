# FlowC Control Plane Configuration - Production Example
# This is an example production configuration with recommended settings

# Server configuration
server:
  api_port: 8080
  xds_port: 18000
  
  # Increased timeouts for production
  read_timeout: "60s"
  write_timeout: "60s"
  idle_timeout: "120s"
  
  # Graceful shutdown
  graceful_shutdown: true
  shutdown_timeout: "30s"

# XDS server configuration
xds:
  default_listener_port: 9095
  default_node_id: "prod-envoy-node"
  
  snapshot_cache:
    ads: true
  
  grpc:
    # More aggressive keepalive for production
    keepalive_time: "60s"
    keepalive_timeout: "10s"
    keepalive_min_time: "10s"
    keepalive_permit_without_stream: true

# Default strategy configurations for production
defaults:
  strategies:
    # Use canary deployments by default in production
    deployment:
      type: "canary"
      canary:
        weight: 10  # Start with 10% traffic to new version
    
    route_matching:
      type: "prefix"
      case_sensitive: true
    
    load_balancing:
      type: "least-request"
      choice_count: 2
      
      # Enable health checking in production
      health_check:
        enabled: true
        interval: "10s"
        timeout: "5s"
        healthy_count: 2
        unhealthy_count: 3
        path: "/health"
        expected_status: 200
    
    # More aggressive retry policy for production
    retry:
      type: "aggressive"
      max_retries: 3
      retry_on: "5xx,reset,connect-failure,retriable-4xx"
      per_try_timeout: "10s"
      retriable_status_codes: [502, 503, 504]
      budget_percent: 20.0
    
    # Enable rate limiting in production
    rate_limiting:
      type: "global"
      requests_per_minute: 10000
      burst_size: 1000
    
    # Full observability enabled
    observability:
      tracing:
        enabled: true
        provider: "jaeger"
        sampling_rate: 0.1  # 10% sampling
        endpoint: "http://jaeger-collector:14268/api/traces"
      
      metrics:
        enabled: true
        provider: "prometheus"
        path: "/metrics"
        port: 9090
      
      access_logs:
        enabled: true
        format: "json"
        path: "/var/log/flowc/access.log"

# Logging configuration for production
logging:
  level: "info"
  format: "json"
  output: "/var/log/flowc/flowc.log"  # Log to file in production
  structured: true
  enable_caller: true
  enable_stacktrace: true

# Feature flags - all enabled in production
features:
  external_translators: true
  openapi_validation: true
  metrics: true
  tracing: true
  rate_limiting: true

